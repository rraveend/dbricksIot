{"version":"NotebookV1","origId":2709685611818225,"name":"Mount Data From Blob","language":"python","commands":[{"version":"CommandV1","origId":2709685611818226,"guid":"47c0e6dd-7dae-41f8-8713-4ce5912f926c","subtype":"command","commandType":"auto","position":1.0,"command":"%md\n##### Define shared methods for mount files from Azure Storage Blob","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c831d1ba-3cdd-4e27-a9d1-6bda6d482e8e"},{"version":"CommandV1","origId":2709685611818228,"guid":"880f25a6-1723-4882-ba67-97e86e6ab74b","subtype":"command","commandType":"auto","position":2.0,"command":"def MountFolder(source, extraConfigs, mountPoint) :\n  try:\n     dbutils.fs.mount(source=source,\n                     mountPoint=mountPoint,\n                     extraConfigs=extraConfigs)\n  except:\n    return\n  \n      ","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537426213384,"submitTime":1537426213360,"finishTime":1537426213488,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":1985061792949798,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"6095e9de-9a20-4d37-8dc0-b9c056c66574"},{"version":"CommandV1","origId":2709685611818229,"guid":"bd67fa7a-3b2d-462a-8f80-6a85ac357e2c","subtype":"command","commandType":"auto","position":3.0,"command":"%md\n\n##### Defining variables required for mounting from blob\nCurrently these are hardcoded, to be changed in following sprint when the Keyvault is configured","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7fb14aa1-3407-4aea-9cda-68436090438c"},{"version":"CommandV1","origId":2709685611818230,"guid":"687f23ed-cfd8-411d-b2e1-cf2eb3c9fa71","subtype":"command","commandType":"auto","position":4.0,"command":"#Storage account and key\nstorage_account_name = \"aothistorianmigrationv2\"\nstorage_account_access_key = \"kzpDkTrQVA0ZP6GpXxfR8PwszjCoq0V2K/NLIF8Q2q/iIWjwedtL1EAEQwO43PTf6rdVx390Sr/AaW/xg7z3nA==\"\n\n#Mapping Configuration file details\nconfig_folder = \"config\"\nconfig_file_type = \"csv\"\nconfig_file_name = \"mappingdata.csv\"\nconfig_file_location = \"wasbs://\"+config_folder+\"@\"+storage_account_name+\".blob.core.windows.net/\"+config_file_name\n\n#\nmountDir = \"/mnt/migration/stage\"\nstage_file_type = \"csv\"","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":null,"error":null,"workflows":[],"startTime":1537427546408,"submitTime":1537427546399,"finishTime":1537427546449,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":1985061792949798,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"514ae254-fa39-4b9c-980d-fc43af674dc1"},{"version":"CommandV1","origId":2709685611818231,"guid":"a5ab0a4e-791c-4916-ba39-3782b3eb3973","subtype":"command","commandType":"auto","position":5.0,"command":"  MountFolder(\n  source = \"wasbs://stage@\"+storage_account_name+\".blob.core.windows.net/2018/09/20\",\n  mountPoint = mountDir,\n  extraConfigs = [(\"fs.azure.account.key.\"+storage_account_name+\".blob.core.windows.net\" , storage_account_access_key)])\n\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[]},"errorSummary":"<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> &apos;return&apos; outside function","error":"<div class=\"ansiout\"><span class=\"ansicyan\">  File </span><span class=\"ansigreen\">&quot;&lt;command-2709685611818231&gt;&quot;</span><span class=\"ansicyan\">, line </span><span class=\"ansigreen\">7</span>\n<span class=\"ansiyellow\">    return</span>\n<span class=\"ansired\">SyntaxError</span><span class=\"ansired\">:</span> &apos;return&apos; outside function\n</div>","workflows":[],"startTime":1537427269838,"submitTime":1537427269818,"finishTime":1537427269913,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":1985061792949798,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"70701e5f-07d0-45c2-9c5d-bc605ba7832d"},{"version":"CommandV1","origId":2709685611818232,"guid":"49caa3e9-522a-4bc4-9d1e-04bf52f1d0df","subtype":"command","commandType":"auto","position":4.5,"command":"%md\n#### Mount the staging folder","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"c875e19f-c0b0-4e39-ad73-6d3d4ea351ed"},{"version":"CommandV1","origId":2709685611818233,"guid":"73f7b6d4-1a91-4a13-bba2-05e2059d5f75","subtype":"command","commandType":"auto","position":6.0,"command":"\nsourceDf = spark.read.format(stage_file_type).option(\"header\",\"true\").option(\"delimiter\", \",\").load(\"/mnt/migration/stage/47_1147_2018-09-17.unl\")\nsourceCols =\"stack(79,'47.MTFC4776C_CV.raw',`47.MTFC4776C_CV.raw`,'47.MTFC4776C_SP.raw',`47.MTFC4776C_SP.raw`,'47.MTFC5171_CV.raw',`47.MTFC5171_CV.raw`,'47.MTFC5171_SP.raw',`47.MTFC5171_SP.raw`,'47.MTFC6171_CV.raw',`47.MTFC6171_CV.raw`,'47.MTFC6171_SP.raw',`47.MTFC6171_SP.raw`,'47.MTFC6177_CV.raw',`47.MTFC6177_CV.raw`,'47.MTFC6177_SP.raw',`47.MTFC6177_SP.raw`,'47.MTFC6877_CV.raw',`47.MTFC6877_CV.raw`,'47.MTFC6877_SP.raw',`47.MTFC6877_SP.raw`,'47.MTAC9056_CV.raw',`47.MTAC9056_CV.raw`,'47.MTAC9056_PV.raw',`47.MTAC9056_PV.raw`,'47.MTAC9056_SP.raw',`47.MTAC9056_SP.raw`,'47.MFTT8793.raw',`47.MFTT8793.raw`,'47.MFTT8795.raw',`47.MFTT8795.raw`,'47.MFTT8841.raw',`47.MFTT8841.raw`,'47.MFTT8869.raw',`47.MFTT8869.raw`,'47.P2VSD020_CV.raw',`47.P2VSD020_CV.raw`,'47.P2VSD020_OPER.raw',`47.P2VSD020_OPER.raw`,'47.P2LT0005_PV.raw',`47.P2LT0005_PV.raw`,'47.P2LT0006_PV.raw',`47.P2LT0006_PV.raw`,'47.OP_CC1CS.raw',`47.OP_CC1CS.raw`,'47.OP_CC1_2CS.raw',`47.OP_CC1_2CS.raw`,'47.OP_CC2CS.raw',`47.OP_CC2CS.raw`,'47.P5PCD266M.raw',`47.P5PCD266M.raw`,'47.P5PCD266OP.raw',`47.P5PCD266OP.raw`,'47.P5PCD266SP.raw',`47.P5PCD266SP.raw`,'47.P5PCE266M.raw',`47.P5PCE266M.raw`,'47.P5PCE266OP.raw',`47.P5PCE266OP.raw`,'47.P5PCE266SP.raw',`47.P5PCE266SP.raw`,'47.P5PCF266M.raw',`47.P5PCF266M.raw`,'47.P5PCF266OP.raw',`47.P5PCF266OP.raw`,'47.P5PCF266SP.raw',`47.P5PCF266SP.raw`,'47.P5PCG266M.raw',`47.P5PCG266M.raw`,'47.P5PCG266OP.raw',`47.P5PCG266OP.raw`,'47.P5PCG266SP.raw',`47.P5PCG266SP.raw`,'47.P5PTD265.raw',`47.P5PTD265.raw`,'47.P5PTD266.raw',`47.P5PTD266.raw`,'47.P5PTE265.raw',`47.P5PTE265.raw`,'47.P5PTE266.raw',`47.P5PTE266.raw`,'47.P5PTF265.raw',`47.P5PTF265.raw`,'47.P5PTF266.raw',`47.P5PTF266.raw`,'47.P5PTG265.raw',`47.P5PTG265.raw`,'47.P5PTG266.raw',`47.P5PTG266.raw`,'47.MFPCM393_PV.raw',`47.MFPCM393_PV.raw`,'47.MFPCM493_PV.raw',`47.MFPCM493_PV.raw`,'47.MFPCM593_PV.raw',`47.MFPCM593_PV.raw`,'47.MFPCM693_PV.raw',`47.MFPCM693_PV.raw`,'47.MFPTM394_IN.raw',`47.MFPTM394_IN.raw`,'47.MFPTM494_IN.raw',`47.MFPTM494_IN.raw`,'47.MFPTM594_IN.raw',`47.MFPTM594_IN.raw`,'47.MFPTM694_IN.raw',`47.MFPTM694_IN.raw`,'47.MP5DAPCON.raw',`47.MP5DAPCON.raw`,'47.MP5DAPCONSTATUS.raw',`47.MP5DAPCONSTATUS.raw`,'47.WPLTZ032.raw',`47.WPLTZ032.raw`,'47.WPLTZ056.raw',`47.WPLTZ056.raw`,'47.P1PP5010_RUN.raw',`47.P1PP5010_RUN.raw`,'47.P1PP5013_RUN.raw',`47.P1PP5013_RUN.raw`,'47.P1PP5014_RUN.raw',`47.P1PP5014_RUN.raw`,'47.P1PP5015_RUN.raw',`47.P1PP5015_RUN.raw`,'47.P1PP5016_RUN.raw',`47.P1PP5016_RUN.raw`,'47.P1PT5047_PV.raw',`47.P1PT5047_PV.raw`,'47.P1PT5102_PV.raw',`47.P1PT5102_PV.raw`,'47.P1PT5202_PV.raw',`47.P1PT5202_PV.raw`,'47.P1PT5302_PV.raw',`47.P1PT5302_PV.raw`,'47.RO4_STEP.raw',`47.RO4_STEP.raw`,'47.APA_P1_4E_State.raw',`47.APA_P1_4E_State.raw`,'47.APA_P1_RO_State.raw',`47.APA_P1_RO_State.raw`,'47.FD060_SW8.raw',`47.FD060_SW8.raw`,'47.AB3212_REAL.raw',`47.AB3212_REAL.raw`,'47.AB3222_REAL.raw',`47.AB3222_REAL.raw`,'47.AB3232_REAL.raw',`47.AB3232_REAL.raw`,'47.AB3242_REAL.raw',`47.AB3242_REAL.raw`,'47.AB3912_REAL.raw',`47.AB3912_REAL.raw`,'47.AB3922_REAL.raw',`47.AB3922_REAL.raw`,'47.AB3932_REAL.raw',`47.AB3932_REAL.raw`,'47.AB3942_REAL.raw',`47.AB3942_REAL.raw`,'47.AB612_REAL.raw',`47.AB612_REAL.raw`,'47.AB622_REAL.raw',`47.AB622_REAL.raw`) as (TagName,Value)\"\n\ntransformedData = sourceDf.selectExpr(\"sample_dt\", sourceCols).where(\"Value is not null\")\n\n","commandVersion":0,"state":"finished","results":{"type":"html","data":"<div class=\"ansiout\"></div>","arguments":{},"addedWidgets":{},"removedWidgets":[],"datasetInfos":[{"name":"sourceDf","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"sample_dt","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC4776C_CV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC4776C_SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC5171_CV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC5171_SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC6171_CV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC6171_SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC6177_CV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC6177_SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC6877_CV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTFC6877_SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTAC9056_CV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTAC9056_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MTAC9056_SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFTT8793.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFTT8795.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFTT8841.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFTT8869.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P2VSD020_CV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P2VSD020_OPER.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P2LT0005_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P2LT0006_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.OP_CC1CS.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.OP_CC1_2CS.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.OP_CC2CS.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCD266M.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCD266OP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCD266SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCE266M.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCE266OP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCE266SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCF266M.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCF266OP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCF266SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCG266M.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCG266OP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PCG266SP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PTD265.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PTD266.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PTE265.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PTE266.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PTF265.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PTF266.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PTG265.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P5PTG266.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFPCM393_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFPCM493_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFPCM593_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFPCM693_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFPTM394_IN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFPTM494_IN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFPTM594_IN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MFPTM694_IN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MP5DAPCON.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.MP5DAPCONSTATUS.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.WPLTZ032.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.WPLTZ056.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PP5010_RUN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PP5013_RUN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PP5014_RUN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PP5015_RUN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PP5016_RUN.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PT5047_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PT5102_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PT5202_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.P1PT5302_PV.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.RO4_STEP.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.APA_P1_4E_State.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.APA_P1_RO_State.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.FD060_SW8.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB3212_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB3222_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB3232_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB3242_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB3912_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB3922_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB3932_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB3942_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB612_REAL.raw","nullable":true,"type":"string"},{"metadata":{},"name":"47.AB622_REAL.raw","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null},{"name":"transformedData","typeStr":"pyspark.sql.dataframe.DataFrame","schema":{"fields":[{"metadata":{},"name":"sample_dt","nullable":true,"type":"string"},{"metadata":{},"name":"TagName","nullable":true,"type":"string"},{"metadata":{},"name":"Value","nullable":true,"type":"string"}],"type":"struct"},"tableIdentifier":null}]},"errorSummary":"<span class=\"ansired\">NameError</span>: name &apos;file_type&apos; is not defined","error":"<div class=\"ansiout\"><span class=\"ansired\">---------------------------------------------------------------------------</span>\n<span class=\"ansired\">NameError</span>                                 Traceback (most recent call last)\n<span class=\"ansigreen\">&lt;command-2709685611818233&gt;</span> in <span class=\"ansicyan\">&lt;module&gt;</span><span class=\"ansiblue\">()</span>\n<span class=\"ansigreen\">      1</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">----&gt; 2</span><span class=\"ansiyellow\"> </span>sourceDf <span class=\"ansiyellow\">=</span> spark<span class=\"ansiyellow\">.</span>read<span class=\"ansiyellow\">.</span>format<span class=\"ansiyellow\">(</span>file_type<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>option<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;header&quot;</span><span class=\"ansiyellow\">,</span><span class=\"ansiblue\">&quot;true&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>option<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;delimiter&quot;</span><span class=\"ansiyellow\">,</span> <span class=\"ansiblue\">&quot;,&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>load<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;/mnt/migration/stage/47_1147_2018-09-17.unl&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      3</span> sourceCols <span class=\"ansiyellow\">=</span><span class=\"ansiblue\">&quot;stack(79,&apos;47.MTFC4776C_CV.raw&apos;,&#96;47.MTFC4776C_CV.raw&#96;,&apos;47.MTFC4776C_SP.raw&apos;,&#96;47.MTFC4776C_SP.raw&#96;,&apos;47.MTFC5171_CV.raw&apos;,&#96;47.MTFC5171_CV.raw&#96;,&apos;47.MTFC5171_SP.raw&apos;,&#96;47.MTFC5171_SP.raw&#96;,&apos;47.MTFC6171_CV.raw&apos;,&#96;47.MTFC6171_CV.raw&#96;,&apos;47.MTFC6171_SP.raw&apos;,&#96;47.MTFC6171_SP.raw&#96;,&apos;47.MTFC6177_CV.raw&apos;,&#96;47.MTFC6177_CV.raw&#96;,&apos;47.MTFC6177_SP.raw&apos;,&#96;47.MTFC6177_SP.raw&#96;,&apos;47.MTFC6877_CV.raw&apos;,&#96;47.MTFC6877_CV.raw&#96;,&apos;47.MTFC6877_SP.raw&apos;,&#96;47.MTFC6877_SP.raw&#96;,&apos;47.MTAC9056_CV.raw&apos;,&#96;47.MTAC9056_CV.raw&#96;,&apos;47.MTAC9056_PV.raw&apos;,&#96;47.MTAC9056_PV.raw&#96;,&apos;47.MTAC9056_SP.raw&apos;,&#96;47.MTAC9056_SP.raw&#96;,&apos;47.MFTT8793.raw&apos;,&#96;47.MFTT8793.raw&#96;,&apos;47.MFTT8795.raw&apos;,&#96;47.MFTT8795.raw&#96;,&apos;47.MFTT8841.raw&apos;,&#96;47.MFTT8841.raw&#96;,&apos;47.MFTT8869.raw&apos;,&#96;47.MFTT8869.raw&#96;,&apos;47.P2VSD020_CV.raw&apos;,&#96;47.P2VSD020_CV.raw&#96;,&apos;47.P2VSD020_OPER.raw&apos;,&#96;47.P2VSD020_OPER.raw&#96;,&apos;47.P2LT0005_PV.raw&apos;,&#96;47.P2LT0005_PV.raw&#96;,&apos;47.P2LT0006_PV.raw&apos;,&#96;47.P2LT0006_PV.raw&#96;,&apos;47.OP_CC1CS.raw&apos;,&#96;47.OP_CC1CS.raw&#96;,&apos;47.OP_CC1_2CS.raw&apos;,&#96;47.OP_CC1_2CS.raw&#96;,&apos;47.OP_CC2CS.raw&apos;,&#96;47.OP_CC2CS.raw&#96;,&apos;47.P5PCD266M.raw&apos;,&#96;47.P5PCD266M.raw&#96;,&apos;47.P5PCD266OP.raw&apos;,&#96;47.P5PCD266OP.raw&#96;,&apos;47.P5PCD266SP.raw&apos;,&#96;47.P5PCD266SP.raw&#96;,&apos;47.P5PCE266M.raw&apos;,&#96;47.P5PCE266M.raw&#96;,&apos;47.P5PCE266OP.raw&apos;,&#96;47.P5PCE266OP.raw&#96;,&apos;47.P5PCE266SP.raw&apos;,&#96;47.P5PCE266SP.raw&#96;,&apos;47.P5PCF266M.raw&apos;,&#96;47.P5PCF266M.raw&#96;,&apos;47.P5PCF266OP.raw&apos;,&#96;47.P5PCF266OP.raw&#96;,&apos;47.P5PCF266SP.raw&apos;,&#96;47.P5PCF266SP.raw&#96;,&apos;47.P5PCG266M.raw&apos;,&#96;47.P5PCG266M.raw&#96;,&apos;47.P5PCG266OP.raw&apos;,&#96;47.P5PCG266OP.raw&#96;,&apos;47.P5PCG266SP.raw&apos;,&#96;47.P5PCG266SP.raw&#96;,&apos;47.P5PTD265.raw&apos;,&#96;47.P5PTD265.raw&#96;,&apos;47.P5PTD266.raw&apos;,&#96;47.P5PTD266.raw&#96;,&apos;47.P5PTE265.raw&apos;,&#96;47.P5PTE265.raw&#96;,&apos;47.P5PTE266.raw&apos;,&#96;47.P5PTE266.raw&#96;,&apos;47.P5PTF265.raw&apos;,&#96;47.P5PTF265.raw&#96;,&apos;47.P5PTF266.raw&apos;,&#96;47.P5PTF266.raw&#96;,&apos;47.P5PTG265.raw&apos;,&#96;47.P5PTG265.raw&#96;,&apos;47.P5PTG266.raw&apos;,&#96;47.P5PTG266.raw&#96;,&apos;47.MFPCM393_PV.raw&apos;,&#96;47.MFPCM393_PV.raw&#96;,&apos;47.MFPCM493_PV.raw&apos;,&#96;47.MFPCM493_PV.raw&#96;,&apos;47.MFPCM593_PV.raw&apos;,&#96;47.MFPCM593_PV.raw&#96;,&apos;47.MFPCM693_PV.raw&apos;,&#96;47.MFPCM693_PV.raw&#96;,&apos;47.MFPTM394_IN.raw&apos;,&#96;47.MFPTM394_IN.raw&#96;,&apos;47.MFPTM494_IN.raw&apos;,&#96;47.MFPTM494_IN.raw&#96;,&apos;47.MFPTM594_IN.raw&apos;,&#96;47.MFPTM594_IN.raw&#96;,&apos;47.MFPTM694_IN.raw&apos;,&#96;47.MFPTM694_IN.raw&#96;,&apos;47.MP5DAPCON.raw&apos;,&#96;47.MP5DAPCON.raw&#96;,&apos;47.MP5DAPCONSTATUS.raw&apos;,&#96;47.MP5DAPCONSTATUS.raw&#96;,&apos;47.WPLTZ032.raw&apos;,&#96;47.WPLTZ032.raw&#96;,&apos;47.WPLTZ056.raw&apos;,&#96;47.WPLTZ056.raw&#96;,&apos;47.P1PP5010_RUN.raw&apos;,&#96;47.P1PP5010_RUN.raw&#96;,&apos;47.P1PP5013_RUN.raw&apos;,&#96;47.P1PP5013_RUN.raw&#96;,&apos;47.P1PP5014_RUN.raw&apos;,&#96;47.P1PP5014_RUN.raw&#96;,&apos;47.P1PP5015_RUN.raw&apos;,&#96;47.P1PP5015_RUN.raw&#96;,&apos;47.P1PP5016_RUN.raw&apos;,&#96;47.P1PP5016_RUN.raw&#96;,&apos;47.P1PT5047_PV.raw&apos;,&#96;47.P1PT5047_PV.raw&#96;,&apos;47.P1PT5102_PV.raw&apos;,&#96;47.P1PT5102_PV.raw&#96;,&apos;47.P1PT5202_PV.raw&apos;,&#96;47.P1PT5202_PV.raw&#96;,&apos;47.P1PT5302_PV.raw&apos;,&#96;47.P1PT5302_PV.raw&#96;,&apos;47.RO4_STEP.raw&apos;,&#96;47.RO4_STEP.raw&#96;,&apos;47.APA_P1_4E_State.raw&apos;,&#96;47.APA_P1_4E_State.raw&#96;,&apos;47.APA_P1_RO_State.raw&apos;,&#96;47.APA_P1_RO_State.raw&#96;,&apos;47.FD060_SW8.raw&apos;,&#96;47.FD060_SW8.raw&#96;,&apos;47.AB3212_REAL.raw&apos;,&#96;47.AB3212_REAL.raw&#96;,&apos;47.AB3222_REAL.raw&apos;,&#96;47.AB3222_REAL.raw&#96;,&apos;47.AB3232_REAL.raw&apos;,&#96;47.AB3232_REAL.raw&#96;,&apos;47.AB3242_REAL.raw&apos;,&#96;47.AB3242_REAL.raw&#96;,&apos;47.AB3912_REAL.raw&apos;,&#96;47.AB3912_REAL.raw&#96;,&apos;47.AB3922_REAL.raw&apos;,&#96;47.AB3922_REAL.raw&#96;,&apos;47.AB3932_REAL.raw&apos;,&#96;47.AB3932_REAL.raw&#96;,&apos;47.AB3942_REAL.raw&apos;,&#96;47.AB3942_REAL.raw&#96;,&apos;47.AB612_REAL.raw&apos;,&#96;47.AB612_REAL.raw&#96;,&apos;47.AB622_REAL.raw&apos;,&#96;47.AB622_REAL.raw&#96;) as (TagName,Value)&quot;</span><span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      4</span> <span class=\"ansiyellow\"></span>\n<span class=\"ansigreen\">      5</span> transformedData <span class=\"ansiyellow\">=</span> sourceDf<span class=\"ansiyellow\">.</span>selectExpr<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;sample_dt&quot;</span><span class=\"ansiyellow\">,</span> sourceCols<span class=\"ansiyellow\">)</span><span class=\"ansiyellow\">.</span>where<span class=\"ansiyellow\">(</span><span class=\"ansiblue\">&quot;Value is not null&quot;</span><span class=\"ansiyellow\">)</span><span class=\"ansiyellow\"></span>\n\n<span class=\"ansired\">NameError</span>: name &apos;file_type&apos; is not defined</div>","workflows":[],"startTime":1537427555704,"submitTime":1537427555683,"finishTime":1537427557031,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"rakeshr@microsoft.com","latestUserId":"1985061792949798","commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"7d9612f0-f4a4-4522-8d5c-3f373e90edd3"},{"version":"CommandV1","origId":2709685611818234,"guid":"f8f6dc11-cae2-451b-982c-d7ebf2a9dc49","subtype":"command","commandType":"auto","position":7.0,"command":"spark.sql(\"CREATE DATABASE IF NOT EXISTS DataMigration\")\nspark.sql(\"USE DataMigration\")\n","commandVersion":0,"state":"error","results":null,"errorSummary":null,"error":null,"workflows":[],"startTime":0,"submitTime":0,"finishTime":0,"collapsed":false,"bindings":{},"inputWidgets":{},"displayType":"table","width":"auto","height":"auto","xColumns":null,"yColumns":null,"pivotColumns":null,"pivotAggregation":null,"customPlotOptions":{},"commentThread":[],"commentsVisible":false,"parentHierarchy":[],"diffInserts":[],"diffDeletes":[],"globalVars":{},"latestUser":"","latestUserId":null,"commandTitle":"","showCommandTitle":false,"hideCommandCode":false,"hideCommandResult":false,"iPythonMetadata":null,"streamStates":{},"datasetPreviewNameToCmdIdMap":{},"nuid":"3239e08a-a518-4bdf-a14d-4694375245f4"}],"dashboards":[],"guid":"a1dd87ea-8d65-4d84-8720-3ad678d21fe1","globalVars":{},"iPythonMetadata":null,"inputWidgets":{}}